<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/index.css">
  <title>Index</title>
</head>
<body>
  <!-- Header -->
  <header class="l-header">
    <div class="nav">
      <div class="nav__brand u-text-headline u-c-pri-70">台北一日遊</div>
      <div class="nav__menu">
        <button class="nav__btn u-text-body u-c-sec-70 u-bg-white">預定行程</button>
        <button class="nav__btn u-text-body u-c-sec-70 u-bg-white">登入/註冊</button>
      </div>
    </div> 
  </header>
  <!-- Hero -->
  <div class="l-hero">
    <img class="hero__img" src="/static/welcome.png">
    <div class="hero__content">
      <div class="hero__slogan">
        <div class="hero__title u-c-white u-text-sloganTitle">輕鬆享受台北一日悠閒</div>
        <div class="hero__subtitle u-c-white u-text-body--bold">探索每個角落，體驗城市的深度旅遊行程</div>
      </div>
      <div class="hero__search">
        <div class="search">
          <button class="search__categories-btn u-text-body">全部分類▼</button>
          <input class="search__input" placeholder="輸入景點名稱查詢" id="search__input">
          <button class="search__btn">
            <img class="search__icon" src="/static/icon_search.png">
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- Atrractions area -->
  <div class="l-attractions">
    <!-- Atrraction list bar -->
    <div class="listBar u-bg-white">
      <div class="listBar__nav--left">
        <button class="listBar__btn u-bg-white" id="listBar-left-btn">
          <img class="listBar__icon" src="/static/left-btn.png">
        </button>
      </div>
      <div class="listBar__viewport">
        <div class="listBar__list">
          <!-- JS填充 -->
        </div>
      </div>
      <div class="listBar__nav--right">
        <button class="listBar__btn u-bg-white" id="listBar-right-btn">
          <img class="listBar__icon" src="/static/right-btn.png">
        </button>
      </div>
    </div>
    <!-- Card grid  -->
    <div class="cardGrid">
      <!-- Card 填充物 -->
      <!-- 填充物範本 
      <div class="card u-c-white">
        <div class="card__media">
          <img class="card__img" src="">
          <div class="card__title">
            <div class="card__titleText u-text-body--bold u-c-white">平安鐘</div>
          </div>
        </div>
        <div class="card__detail">
          <div class="card__info card__info--mrt u-text-body u-c-sec-50">忠孝復興</div>
          <div class="card__info card__info--category u-text-body u-c-sec-50">公共藝術</div>
        </div>
      </div>  
      -->
      
    </div>
  </div>
  <!-- Footer -->
  <div class="Footer">
    
  </div>
  <script defer>
    const bar = document.querySelector('.listBar');
    const listBar_list = bar.querySelector('.listBar__list');
    const left_btn = bar.querySelector('#listBar-left-btn');
    const right_btn = bar.querySelector('#listBar-right-btn');
    // 計算每次滑動的位移量，clientWidth：該元素「可視內容看」的寬度
    function step(){
      return listBar_list.clientWidth * 2 / 3;
    }
    
    left_btn.addEventListener('click',() => {
      listBar_list.scrollBy({left: -step(), behavior: "smooth"});
    });
    // scrollBy：相對捲動，left：水平捲動位移量
    right_btn.addEventListener('click',() => {
      listBar_list.scrollBy({left: step(), behavior: "smooth"});
    });

    async function get_data(url) {
      const res = await fetch(url);
      const ct = res.headers.get('content-type') || '';
      const body = ct.includes('application/json') ? await res.json() : await res.text();

      if (!res.ok){
        const err = new Error (`HTTP ${res.status}`);
        err.status = res.status;
        err.payload = body;
        throw err;
      }
      return body;
    }

    async function startup(){
      // List bar
      try{
        const result = await get_data("/api/mrts");
        const data = result.data;
        data.forEach(d => {
          const listBar_item = document.createElement('div');
          listBar_item.classList = "listBar__item u-text-body u-c-sec-70";
          listBar_item.textContent = d;
          listBar_list.append(listBar_item);
        });
      }catch(e){
        console.log(e)
      }

      // Attraction
      try{
        const result = await get_data("/api/attractions?page=0");
        const data = result.data;
        console.log(data);
        const card_grid = document.querySelector('.cardGrid')
        data.forEach(d => {
          // card__caontainer
          const card_title_text = document.createElement('div');
          card_title_text.classList = "card__titleText u-text-body--bold u-c-white";
          card_title_text.textContent = d.name;
          const card_title = document.createElement('div');
          card_title.classList = "card__title";
          card_title.append(card_title_text);
          const card_img = document.createElement('img');
          card_img.classList = "card__img";
          card_img.src = d.images[0];
          const card_media = document.createElement('div');
          card_media.classList = "card__media";
          card_media.append(card_img);
          card_media.append(card_title);
          // card__detail
          const card_info_mrt = document.createElement('div');
          card_info_mrt.classList = "card__info card__info--mrt u-text-body u-c-sec-50";
          card_info_mrt.textContent = d.mrt;
          const card_info_category = document.createElement('div');
          card_info_category.classList = "card__info card__info--category u-text-body u-c-sec-50";
          card_info_category.textContent = d.category;
          const card_detail = document.createElement('div');
          card_detail.classList = "card__detail";
          card_detail.append(card_info_mrt);
          card_detail.append(card_info_category);
          // card
          const card = document.createElement('div');
          card.classList = "card u-c-white";
          card.append(card_media);
          card.append(card_detail);
          // insert card
          card_grid.append(card);
        });
      }catch(e){
        console.log(e);
      }
    }
    startup();
    

  </script>
</body>
</html>